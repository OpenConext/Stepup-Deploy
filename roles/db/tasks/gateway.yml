# Database configuration for gateway component

- name: Create Gateway database
  mysql_db: name={{ database_gateway_name }} state=present login_user=root login_password={{ mariadb_root_password | vault(vault_keydir) }}

- name: Create Gateway test database
  mysql_db: name=gateway_test state=present login_user=root login_password={{ mariadb_root_password | vault(vault_keydir) }}

- name: Create gateway user
  mysql_user:
    name: "{{ database_gateway_user }}"
    host: "%"
    password: "{{ database_gateway_password | vault(vault_keydir) }}"
    priv: "{{ database_gateway_name }}.*:SELECT/gateway_test.*:SELECT"
    login_user: root
    login_password: "{{ mariadb_root_password | vault(vault_keydir) }}"

- name: Create gateway read-only user
  mysql_user:
    name: "{{ database_gateway_readonly_user }}"
    host: "%"
    password: "{{ database_gateway_readonly_password | vault(vault_keydir) }}"
    priv: "{{ database_gateway_name }}.*:SELECT/gateway_test.*:SELECT"
    login_host: "127.0.0.1"
    login_user: "root"
    login_password: "{{ mariadb_root_password | vault(vault_keydir) }}"
  when: database_gateway_readonly_user is defined
