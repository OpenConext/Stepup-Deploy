<?php

// MANAGED BY ANSIBLE

// This is the IdP that is hosted by this instance.
// It is used as a "remote IdP" by the stepup gateway
// See: authsources.php for a list of accounts that are defined at this IdP

/**
 * SAML 2.0 IdP configuration for simpleSAMLphp.
 *
 * See: https://rnd.feide.no/content/idp-hosted-metadata-reference
 */

$metadata['https://{{ ssp_vhost_name }}/simplesamlphp/saml2/idp/metadata.php'] = array(
        /*
         * The hostname of the server (VHOST) that will use this SAML entity.
         *
         * Can be '__DEFAULT__', to use this entry by default.
         */
        'host' => '__DEFAULT__',

		'signature.algorithm' => 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256',

        /* X.509 key and certificate. Relative to the cert directory. */
        'privatekey' => 'idp.key',
        'certificate' => 'idp.crt',

        /*
         * Authentication source to use. Must be one that is configured in
         * 'config/authsources.php'.
         */
        'auth' => 'example-userpass',

        /*
         * WARNING: SHA-1 is disallowed starting January the 1st, 2014.
         *
         * Uncomment the following option to start using SHA-256 for your signatures.
         * Currently, simpleSAMLphp defaults to SHA-1, which has been deprecated since
         * 2011, and will be disallowed by NIST as of 2014. Please refer to the following
         * document for more information:
         * 
         * http://csrc.nist.gov/publications/nistpubs/800-131A/sp800-131A.pdf
         *
         * If you are uncertain about service providers supporting SHA-256 or other
         * algorithms of the SHA-2 family, you can configure it individually in the
         * SP-remote metadata set for those that support it. Once you are certain that
         * all your configured SPs support SHA-2, you can safely remove the configuration
         * options in the SP-remote metadata set and uncomment the following option.
         *
         * Please refer to the IdP hosted reference for more information.
         */

	//'attributes.NameFormat' => 'urn:oasis:names:tc:SAML:2.0:attrname-format:uri',
	//'attributes.NameFormat' => 'urn:oasis:names:tc:SAML:2.0:attrname-format:basic',
	'attributes.NameFormat' => 'urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified',

	// Sign logout request and logout responses 
	'redirect.sign' => TRUE,

	// Require validate signature on requests
	'redirect.validate' => FALSE,

	// Sign response
	'saml20.sign.response' => FALSE,

	// Sign assertion
	'saml20.sign.assertion' => TRUE,

	// Enable artifact binding support
	'saml20.sendartifact' => TRUE,

        //'signature.algorithm' => 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256',
        /* Uncomment the following to use the uri NameFormat on attributes. */
        /*
        'attributes.NameFormat' => 'urn:oasis:names:tc:SAML:2.0:attrname-format:uri',
        'authproc' => array(
                // Convert LDAP names to oids.
                100 => array('class' => 'core:AttributeMap', 'name2oid'),
        ),
        */
);

